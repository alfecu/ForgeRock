/*!
 * Copyright 2019-2020 ForgeRock AS. All Rights Reserved 
 *  Use of this code requires a commercial software license with ForgeRock AS. or with one of its affiliates. All use shall be exclusively subject to such license between the licensee and ForgeRock AS.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-587ca685"],{"484a":function(e,t,a){},"9e67":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("b-modal",{ref:"fsModal",attrs:{id:"userDetailsModal","modal-class":"fr-full-screen","cancel-variant":"outline-secondary"},on:{show:e.setModal},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.saveForm(t))}}},[a("div",{staticClass:"d-flex w-100 h-100",attrs:{slot:"modal-header"},slot:"modal-header"},[a("h5",{staticClass:"modal-title align-self-center text-center"},[e._v(e._s(e.title))]),a("button",{staticClass:"close",attrs:{type:"button","aria-label":"Close"},on:{click:e.hideModal}},[a("i",{staticClass:"fa fa-times"})])]),a("b-container",[a("b-row",[a("b-col",{attrs:{sm:"8","offset-sm":"2"}},[a("ValidationObserver",{ref:"observer",attrs:{slim:""}},[e.formFields.length>0?a("b-form",{staticClass:"mb-3 fr-edit-personal-form",staticStyle:{"flex-direction":"column"},attrs:{name:"edit-personal-form"}},[e._l(e.displayFields,(function(t,i){return["string"===t.type||"number"===t.type?a("b-form-group",{key:i,staticStyle:{"min-width":"200px"}},[a("label",{attrs:{for:t.title}},[e._v(e._s(t.title))]),t.required?e._e():a("small",{staticClass:"text-muted ml-1"},[e._v(e._s(e.$t("pages.profile.editProfile.optional")))]),a("ValidationProvider",{attrs:{rules:t.required?"required":"",name:t.name},scopedSlots:e._u([{key:"default",fn:function(r){return[a("b-input",{attrs:{name:t.name,type:"string"===t.type?"text":t.type,state:e.getValidationState(r)},model:{value:e.formFields[i].value,callback:function(t){e.$set(e.formFields[i],"value","string"===typeof t?t.trim():t)},expression:"formFields[index].value"}}),a("b-form-invalid-feedback",[e._v(e._s(r.errors[0]))])]}}],null,!0)})],1):e._e(),"boolean"===t.type?a("b-form-group",{key:i},[a("div",{staticClass:"d-flex flex-column"},[a("label",{staticClass:"mr-auto",attrs:{for:t.title}},[e._v(e._s(t.title))]),a("div",{staticClass:"mr-auto"},[a("toggle-button",{staticClass:"mt-2 p-0 fr-toggle-primary",attrs:{height:28,width:56,sync:!0,cssColors:!0,labels:{checked:e.$t("common.form.yes"),unchecked:e.$t("common.form.no")},value:e.formFields[i].value},on:{change:function(t){e.formFields[i].value=!e.formFields[i].value}}})],1)])]):e._e()]}))],2):[a("h3",{staticClass:"text-center"},[e._v(e._s(e.$t("pages.profile.editProfile.noFields")))])]],2)],1)],1)],1),a("div",{staticClass:"w-100",attrs:{slot:"modal-footer"},slot:"modal-footer"},[a("div",{staticClass:"float-right"},[a("b-btn",{attrs:{variant:"outline-secondary mr-2"},on:{click:e.hideModal}},[e._v(e._s(e.$t("common.form.cancel")))]),a("b-btn",{attrs:{type:"button",variant:"primary",disabled:e.$root.userStore.state.internalUser},on:{click:e.saveForm}},[e._v(e._s(e.$t("common.form.saveChanges")))])],1)])],1)},r=[],o=a("2ef0"),l=a.n(o),s=a("eea2"),n={name:"Edit-Personal-Info",mixins:[s["a"]],components:{},props:{schema:{type:Object,required:!0},profile:{type:Object,required:!0},autoOpen:{type:Boolean,required:!1,default:!1}},data:function(){return{formFields:[],originalFormFields:[],title:this.$t("pages.profile.editProfile.userDetailsTitle")}},mounted:function(){this.autoOpen&&this.$root.$emit("bv::show::modal","userDetailsModal")},computed:{displayFields:function(){var e=this.schema.properties,t=l.a.filter(this.formFields,(function(t){return e[t.name].userEditable}));return t}},methods:{generateFormFields:function(){var e=this,t=this.schema,a=t.order,i=t.properties,r=t.required,o=l.a.filter(a,(function(e){return i[e].viewable&&"array"!==i[e].type&&"object"!==i[e].type})),s=l.a.map(o,(function(t){return{name:t,key:t,title:i[t].title,value:e.profile[t]||null,type:i[t].type,required:l.a.includes(r,t)}}));return s},hideModal:function(){this.$refs.fsModal.hide()},setModal:function(){var e=this.generateFormFields();this.formFields=e,this.originalFormFields=l.a.cloneDeep(e)},saveForm:function(){var e=this;this.$refs.observer.validate().then((function(t){if(t){var a=e.getRequestService(),i={};l.a.each(e.formFields,(function(e){null!==e.value&&(i[e.name]=e.value)})),a.post("policy/".concat(e.$root.userStore.state.managedResource,"/").concat(e.$root.userStore.state.userId,"?_action=validateObject"),i).then((function(t){if(0===t.data.failedPolicyRequirements.length)e.$emit("updateProfile",e.generateUpdatePatch(e.originalFormFields,e.formFields)),e.$refs.observer.reset(),e.hideModal();else{var a=e.findPolicyError({data:{detail:{failedPolicyRequirements:t.data.failedPolicyRequirements}}},e.formFields);if(a.length>0){var i={};l.a.each(a,(function(e){e.exists&&(void 0!==i[e.field]?i[e.field].push(e.msg):i[e.field]=[e.msg])})),e.$refs.observer.setErrors(i)}else e.displayNotification("error",e.$t("pages.profile.editProfile.failedProfileSave"))}}))}}))}}},d=n,u=(a("e03f"),a("2877")),c=Object(u["a"])(d,i,r,!1,null,null,null);t["default"]=c.exports},e03f:function(e,t,a){"use strict";var i=a("484a"),r=a.n(i);r.a},eea2:function(e,t,a){"use strict";var i,r,o=a("2ef0"),l=a.n(o),s={name:"Resource-Mixin",methods:{generateUpdatePatch:function(e,t){var a,i=l.a.cloneDeep(e),r=l.a.cloneDeep(t);return l.a.isArray(r)?a=l.a.filter(r,(function(e,t){return e.value!==i[t].value})):(a=[],l.a.each(r,(function(e,t){l.a.isEqual(i[t],r[t])||a.push({value:r[t],name:t})}))),l.a.map(a,(function(e){return""===e.value||null===e.value?{operation:"remove",field:"/"+e.name}:{operation:"add",field:"/"+e.name,value:e.value}}))},findPolicyError:function(e,t){var a=this,i=[];return l.a.has(e,"data.detail.failedPolicyRequirements")&&l.a.each(e.data.detail.failedPolicyRequirements,(function(e){if(e.policyRequirements.length>0){var r="",o=l.a.find(t,(function(t){return t.key===e.property})),s=e.policyRequirements[0].params||{};o&&(r=o.title?o.title:o.key,s.property=r),i.push({exists:r.length>0,field:e.property,msg:a.$t("common.policyValidationMessages.".concat(e.policyRequirements[0].policyRequirement),s)})}})),i}}},n=s,d=a("2877"),u=Object(d["a"])(n,i,r,!1,null,null,null);t["a"]=u.exports}}]);
//# sourceMappingURL=chunk-587ca685.e1fdad4e.js.map